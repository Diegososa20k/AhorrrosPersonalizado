<div class="container mt-4" ng-controller="gastosDialogCtrl">
  <h2>Gastos — {{ tipoVista | uppercase }}</h2>

  <!-- Total Ahorro del origen -->
  <div class="alert alert-info">
    Total Ahorrado: <strong>{{ totalAhorro | currency:"$":0 }}</strong>
  </div>

  <!-- Formulario: registrar gasto -->
  <form name="formGasto" ng-submit="guardarGasto()" novalidate>
    <div class="form-row">
      <div class="form-group col-md-3">
        <label>Cantidad gastada</label>
        <input type="number" class="form-control" ng-model="gasto.cantidad" min="0" required>
      </div>

      <div class="form-group col-md-3">
        <label>Fecha del gasto</label>
        <input type="date" class="form-control" ng-model="gasto.fecha" required>
      </div>

      <div class="form-group col-md-3">
        <label>Ubicación del dinero</label>
        <select class="form-control" ng-model="gasto.ubicacion" ng-change="onUbicacionChange()">
          <option value="nu">Nu</option>
          <option value="efectivo">Efectivo</option>
          <option value="otro">Otro</option>
        </select>
      </div>

      <div class="form-group col-md-3" ng-show="mostrarNombreCajita">
        <label>Seleccionar cajita</label>
        <select class="form-control" ng-model="gasto.cajita_id" ng-options="c.id as c.nombre for c in cajitasNu">
          <option value="">-- Selecciona una cajita --</option>
        </select>
      </div>
    </div>

    <div class="form-row">
      <!-- Concepto solo si extras -->
      <div class="form-group col-md-3" ng-if="tipoVista === 'extras'">
        <label>Concepto</label>
        <select class="form-control" ng-model="gasto.concepto">
            <option value="saborin">Saborin</option>
            <option value="alcancia">Alcancia</option>
            <option value="ventaAretes">Ventas de aretes</option>
            <option value="ahorroInicio">Ahorro Inicio</option>
            <option value="sorpresa">Sorpresa</option>
            <option value="otro">Otro(lo que sea)</option>
        </select>
      </div>

      <div class="form-group col-md-3" ng-if="tipoVista === 'dineroOtros'">
        <label>Concepto</label>
        <select class="form-control" ng-model="gasto.concepto">
            <option value="mutualistaMama">Mutualista de Mama</option>
            <option value="papaMayra">Papa de Mayra</option>
            <option value="ahorro Mama">Ahorro de Mama</option>
        </select>
      </div>

      <!-- Origen ahorro -->
      <div class="form-group col-md-3">
        <label>Origen Ahorro</label>
        <select class="form-control" ng-model="gasto.origen_ahorro">
          <option value="empanadas" ng-selected="tipoVista==='empanadas'">Empanadas</option>
          <option value="trabajo" ng-selected="tipoVista==='trabajo'">Trabajo</option>
          <option value="extras" ng-selected="tipoVista==='extras'">Extras</option>
          <option value="dineroOtros" ng-selected="tipoVista==='dineroOtros'">Dinero Otras Personas</option>
        </select>
      </div>

      <div class="form-group col-md-6">
        <label>Descripción</label>
        <input type="text" class="form-control" ng-model="gasto.descripcion" placeholder="Detalle del gasto">
      </div>
    </div>

    <button type="submit" class="btn btn-primary" ng-disabled="formGasto.$invalid">Guardar gasto</button>
    <button type="button" class="btn btn-secondary ml-2" ng-click="volver()">← Volver</button>

    <div class="mt-3" ng-if="mensaje">
      <div class="alert" ng-class="mensaje.type">{{ mensaje.text }}</div>
    </div>
  </form>

  <hr>

  <!-- Lista de gastos recientes -->
  <h4 class="mt-4" ng-if="gastosRegistrados.length">Gastos registrados</h4>
  <table class="table table-sm table-striped" ng-if="gastosRegistrados.length">
    <thead>
      <tr>
        <th>Cantidad</th>
        <th>Fecha</th>
        <th>Ubicación</th>
        <th>Cajita</th>
        <th>Concepto</th>
        <th>Origen Ahorro</th>
        <th>Descripción</th>
      </tr>
    </thead>
    <tbody>
      <tr ng-repeat="g in gastosRegistrados">
        <td>{{ g.cantidad | currency:"$":0 }}</td>
        <td>{{ g.fecha | date:"dd/MM/yyyy" }}</td>
        <td>{{ g.ubicacion }}</td>
        <td>{{ g.cajita_id || '-' }}</td>
        <td>{{ g.concepto || '-' }}</td>
        <td>{{ g.origen_ahorro | uppercase }}</td>
        <td>{{ g.descripcion || '-' }}</td>
      </tr>
    </tbody>
  </table>
</div>
