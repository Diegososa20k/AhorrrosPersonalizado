<div class="container mt-4" ng-controller="extraCtrl">
  <h2>Registro de Ahorros - Extras</h2>

  <!-- Total Ahorro -->
  <div class="alert alert-info">
    Total Ahorrado: <strong>{{ totalAhorro | currency:"$":0 }}</strong>
  </div>

  <form name="formAhorro" ng-submit="guardarAhorro()" novalidate>
    <div class="form-group">
      <label>Cantidad a ahorrar</label>
      <input type="number" class="form-control" ng-model="ahorro.cantidad" placeholder="Ej: 5000" required />
    </div>

    <div class="form-group">
      <label>Fecha de depósito</label>
      <input type="date" class="form-control" ng-model="ahorro.fecha" required />
    </div>

    <div class="form-group">
      <label>Ubicación del dinero</label>
      <select class="form-control" ng-model="ahorro.ubicacion" ng-change="onUbicacionChange()">
        <option value="nu">Nu</option>
        <option value="efectivo">Efectivo</option>
        <option value="otro">Otro</option>
      </select>
    </div>

    <div class="form-group" ng-show="mostrarNombreCajita">
      <label>Seleccionar cajita</label>
      <select class="form-control" ng-model="ahorro.cajita_id" ng-options="c.id as c.nombre for c in cajitasNu">
        <option value="">-- Selecciona una cajita --</option>
      </select>
    </div>

    <div class="form-group">
        <label>Seleccionar concepto</label>
        <select class="form-control" ng-model="ahorro.concepto">
            <option value="saborin">Saborin</option>
            <option value="alcancia">Alcancia</option>
            <option value="ventaAretes">Ventas de aretes</option>
            <option value="ahorroInicio">Ahorro Inicio</option>
            <option value="sorpresa">Sorpresa</option>
            <option value="otro">Otro(lo que sea)</option>
        </select>
    </div>



    <button type="submit" class="btn btn-success mt-3" ng-disabled="formAhorro.$invalid">
      Guardar Ahorro
    </button>

    <a ui-sref="gastos({ tipo: 'extras' })" class="btn btn-warning mt-3">
        Gastos
    </a>

    <div class="mt-3" ng-if="mensaje">
      <div class="alert" ng-class="mensaje.type">{{ mensaje.text }}</div>
    </div>
  </form>

<!-- Cards por concepto -->
<div class="row mt-3" ng-if="extras.length > 0">
  <div class="col-md-3 mb-3" ng-repeat="(concepto, data) in totalesPorConcepto">
    <div class="card text-white bg-primary h-100">
      <div class="card-body">
        <h5 class="card-title">{{ concepto }}</h5>
        <p class="card-text">
          Total Ahorrado: {{ data.total | currency:"$":0 }}
        </p>

        <!-- Detalle por ubicación -->
        <ul class="list-unstyled">
          <li>Nu: {{ data.ubicaciones.nu | currency:"$":0 }}</li>
          <li>Efectivo: {{ data.ubicaciones.efectivo | currency:"$":0 }}</li>
          <li>Otro: {{ data.ubicaciones.otro | currency:"$":0 }}</li>
        </ul>
      </div>
    </div>
  </div>
</div>



  <!-- Filtro de búsqueda -->
<div class="form-group">
  <input type="text" class="form-control" ng-model="busqueda" placeholder="Buscar concepto...">
</div>


  <!-- Tabla de registros -->
  <table class="table table-striped mt-4" ng-if="extras.length > 0">
    <thead>
      <tr>
        <th>Cantidad</th>
        <th>Fecha</th>
        <th>Ubicación</th>
        <th>Nombre Cajita</th>
        <th>Concepto</th>
      </tr>
    </thead>
    <tbody>
      <tr ng-repeat="item in extras | filter:busqueda">
        <td>{{ item.cantidad | currency:"$":0 }}</td>
        <td>{{ item.fecha | date:"dd/MM/yyyy" }}</td>
        <td>{{ item.ubicacion }}</td>
        <td>{{ item.nu.nombre || '-' }}</td>
        <td>{{ item.concepto}}</td>
      </tr>
    </tbody>
  </table>

</div>
